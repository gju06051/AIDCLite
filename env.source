#!/bin/bash -X

############################################################
# Set the working directory
############################################################
# 1) from the input argument (github actions)
# 2) from the current working directory (no argument, CLI)
export WORKING_DIR=`pwd`
echo "WORKING_DIR = ${WORKING_DIR}"

############################################################
# Get environment variables from files
############################################################
getEnv() {
    file_name="ENV_$1"
    file_content=`cat ${file_name}`
    if [ ${#file_content} -eq 0 ]  # zero length -> no file or content
    then
        echo "You need to specify the $1 in ${file_name} file"
        exit 1
    else
        export $1=${file_content}
        echo "$1 = ${file_content}"
    fi
}

getEnv "IP_NAME"
getEnv "DESIGN_TOP"
getEnv "DESIGN_FILELIST"
export DESIGN_FILELIST=${WORKING_DIR}/${DESIGN_FILELIST}
echo "DESIGN_FILELIST = ${DESIGN_FILELIST}"
getEnv "TB_FILELIST"
export TB_FILELIST=${WORKING_DIR}/${TB_FILELIST}
echo "TB_FILELIST = ${TB_FILELIST}"

############################################################
# Set IP specific variables
############################################################
export ${IP_NAME}_HOME=${WORKING_DIR}

############################################################
# temporary until we have a seperate repo for GitHub Actions
############################################################
export ACTION_HOME=${WORKING_DIR}/actions
export PATH=${ACTION_HOME}:$PATH

echo "############################################################"
